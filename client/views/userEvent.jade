template(name="userEvent")
  .event
    .row
      .event-head
        .basic-info
          with userEvent
            .row
              .col-md-12
                +summary

      if incidents.length
        .row
          ul.nav.nav-tabs.primary-tabs(role="tablist")
            li(class="{{#if incidentView}}active{{/if}}" role="presentation")
              a(href="{{pathFor route='user-event' _id=userEvent._id _view='incidents'}}") Incident Reports
            li(class="{{#if locationView}}active{{/if}}" role="presentation")
              a(href="{{pathFor route='user-event' _id=userEvent._id _view='locations'}}") Locations

        .tab-content
          .tab-pane.active(role="tabpanel")
            +Template.dynamic template=view data=templateData
      else
        .row
          +addIncidentReport

      .row
        col-lg-6
          +articles

template(name="summary")
  .row.event-summary
    .col-md-6.event-details
      .event-name-wrap
        h1.event-name= eventName
        if isInRole "admin"
          i.fa.fa-edit.edit-event-details(
            data-toggle="modal"
            data-target="#edit-event-modal"
            data-editing='name')
      p.disease-name
        if disease
          span= disease
        else
          span.not-available No disease available.
          if isInRole "admin"
            i.fa.fa-plus-circle.edit-event-details(
              data-toggle="modal"
              data-target="#edit-event-modal"
              data-editing='disease')
      p.abstract.summary(class="{{#unless summary}} shift-up {{/unless}}")
        if summary
          span= summary
        else
          span.not-available No summary available.
          if isInRole "admin"
            i.fa.fa-plus-circle.edit-event-details(
              data-toggle="modal"
              data-target="#edit-event-modal"
              data-editing='summary')
    .col-md-6
      .col-sm-4.col-sm-offset-8.space-btm-1.space-top-1
      table#countTable.col-md-12
        tr.col-md-12
          td.col-md-6.count-cell.count-cell-left.text-center
            .col-md-12.count-cell-value= caseCount
            .col-md-12.count-cell-title Incident Reports
          td.col-md-6.count-cell.text-center
            .col-md-12.count-cell-value= articleCount
            .col-md-12.count-cell-title Sources
        tr.col-md-12.count-table-detail
          td.col-md-5.gi
            span Created:
            | {{formatDate creationDate}} by #{createdByUserName}
          td.col-md-5.gi.gi-cell-center
            span Last Modified:
            | {{formatDate lastModifiedDate}} by #{lastModifiedByUserName}
          td.col-md-2.gi
            button.copy-link.btn.btn-xs.btn-default(type="button" data-clipboard-text="{{urlFor 'user-event'}}")
              i.fa.fa-share-alt
              | Copy Event Link
  +editEventDetailsModal



template(name="locationList")
  #proMedModal.modal.fade(role='dialog')
    .modal-dialog.modal-lg(role='document')
      .modal-content
        .modal-header
          button.fa.fa-times.close.fa-2x(type='button', data-dismiss='modal')
          h4
            a#proMedURL
        .modal-body
          iframe#proMedIFrame
  .row
    .col-md-6
      if incidentLocations.length
        .tab-form
          .row
            .col-lg-12
              +reactiveTableFilter id="locationFilter" label=" " class="input-group table-filter"
        +reactiveTable collection=incidentLocations settings=getSettings
      else
        p No locations are associated with this event.
    .col-md-6
      if incidentLocations.length
        +map event=userEvent incidentLocations=incidentLocations

template(name="location")
  td(colspan="4")
    .tr-detail-container.form-horizontal
      .form-group
        .col-md-12
          h5
            i.fa.fa-link
            | Sources
          ul
            each sources
             li
                a(href=this)= this
                  i.fa.fa-external-link
      .form-group
        .col-md-12
          i.fa.fa-globe
          a(href="http://www.geonames.org/{{id}}")= name
            i.fa.fa-external-link
      .form-group
        .col-md-12
          i.fa.fa-info-circle
          em Added on {{formatDate addedDate}}

template(name="editEventDetailsModal")
  #edit-event-modal.modal.fade(role="dialog")
    .modal-dialog
      .modal-content
        form#editEvent
          .modal-header
            h4.modal-title Edit Event Details
          .modal-body.clearfix
            unless confirmingDeletion
              .form-group
                label Event Name
                input.form-control(type='text' name='eventName' value=eventName required)
              .form-group
                label Event Disease
                input.form-control(type="text" name="eventDisease" value=disease)
              .form-group
                label Event Summary
                textarea.form-control(name="eventSummary" rows="15")= summary
            else
              .delete-confirmation
                i.fa.fa-trash-o
                p Are you sure you want to delete this event?
                p= eventName
                .main-action
                  button.btn.btn-danger.btn-wide.delete-event-confirmation(type="button") Delete Event
                .other-actions
                  button.btn.btn-default.btn-sm.back-to-editing(type="button") Edit Event
                  button.btn.btn-default.btn-sm(type="button" data-dismiss="modal") Cancel

          unless confirmingDeletion
            .modal-footer
              button.btn.btn-danger.delete-event.pull-left(type="button") Delete Event
              button.btn.btn-default(type="button" data-dismiss="modal") Cancel
              button.btn.btn-success.btn-wide.save-modal(type="submit") Save
