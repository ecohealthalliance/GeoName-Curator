template(name="userEvent")
  .container-fluid.fact-sheet-wrap.event.space-btm-4
    .container
      .row
        .col-lg-12.event-head
          .basic-info
            if isEditing
              with userEvent
                form#editEvent.form-horizontal
                  .form-group
                    .col-sm-2
                      button#cancel-edit.btn.btn-default.btn-block(type='button') Cancel
                    .col-sm-2.space-btm-1
                      button#save-edit.btn.btn-primary.btn-block(type='submit') Save
                  .form-group
                    .col-sm-12
                      input.form-control.input-lg(type='text', name='eventName', value='{{eventName}}', placeholder="Event name", required)
                  .form-group
                    .col-md-12
                      textarea.form-control(name="eventSummary", placeholder="Event summary", rows="15") {{summary}}
            else
              with userEvent
                if isInRole "admin"
                  .row
                    .col-sm-2.space-btm-2
                      .dropdown
                        button.btn.btn-default.dropdown-toggle(type="button" data-toggle="dropdown")
                          | Admin Options
                          span.caret
                        ul.dropdown-menu
                          li
                            a.edit-link(href="#") Edit
                          li
                            a.delete-link(href="#") Delete
                .row
                  .col-sm-10
                    h1 {{eventName}}
                  .col-sm-2.space-btm-1
                    button.btn.btn-default.btn-block(type="button" data-target="#shareLink" data-toggle="collapse")
                      i.fa.fa-share
                      | Share
                #shareLink.row.collapse
                  .col-sm-12.shareLink
                    .panel.panel-default
                      .panel-body
                        p Share this event by copying the direct link to this page below.
                        .input-group
                          input#eventLink.form-control(type="text" readonly value="{{urlFor 'user-event'}}")
                          span.input-group-btn
                            button#copyLink.btn.btn-default(type="button" data-clipboard-target="#eventLink")
                              i.fa.fa-clipboard
                .row
                  .col-sm-10.space-btm-2
                    h5 Created by {{createdByUserName}} on {{creationDate}}
                    h5 Last modified by {{lastModifiedByUserName}} on {{lastModifiedDate}}
              .row
                if locations.length
                  .col-lg-7.col-md-12
                    +summary
                  .col-lg-5.col-md-12
                    +map
                else
                  .col-md-12
                    +summary

  .container
    .row
      .col-lg-6
        +articles
      .col-lg-6
        +locationList
    .row
      .col-lg-6
        +counts

template(name="summary")
  if userEvent.summary
    p.abstract {{userEvent.summary}}
  else
    p.abstract No summary available.

template(name="locationList")
  #proMedModal.modal.fade(role='dialog')
    .modal-dialog.modal-lg(role='document')
      .modal-content
        .modal-header
          button.fa.fa-times.close.fa-2x(type='button', data-dismiss='modal')
          h4
            a#proMedURL
        .modal-body
          iframe#proMedIFrame

  .panel.panel-default
    .panel-heading
      h3 Locations
    if currentUser
      .panel-body.comments-container
        if articles.length
          .form-horizontal.comment-form
            .form-group
              label.col-lg-3.control-label Location
              .col-lg-9
                select#location-select2.form-control.select2(name='location')
            .form-group
              label.col-lg-3.control-label Source Articles
              .col-lg-9
                +articleSelect2 selectId="article-select2" articles=articles
            .form-group
              .col-lg-4.col-lg-offset-8.col-md-12
                button#add-location.btn.btn-primary.btn-block(type="button") Add Location
    if locations.length
      ul.list-group
        each locations
          +location
    else
      p No locations are associated with this event.

template(name="location")
  li.list-group-item
    .row
      .col-sm-10.space-btm-2
        a(role="button" href="#{{_id}}" data-toggle="collapse") {{formatLocation(this)}}
        each sourceArticles
          a.proMedLink(href="#" uri=url)
            sup[{{index}}]
      .col-sm-2.col-xs-6
        if currentUser
          button.btn.btn-danger.btn-sm.btn-block.remove-location(type="button") Delete
    .collapse(id="{{_id}}").space-top-2
      .row
        label.col-md-3 Geonames Link
        .col-md-9
          p
            a(href="{{url}}") {{displayName}}
              i.fa.fa-external-link
      .row
        label.col-md-3 Added By
        .col-md-9
          p {{addedByUserName}}
      .row
        label.col-md-3 Added On
        .col-md-9
          p {{addedDate}}
      .row
        label.col-md-3 Sources
        .col-md-9
          if isEditingSources
            +articleSelect2 selectId=articleSelectId articles=allArticles selected=selectedArticles
          else
            each sourceArticles
              p
                |[{{index}}]
                a(href="{{url}}") {{url}}
                  i.fa.fa-external-link
      if currentUser
        .row.space-top-2
          if isEditingSources
            .col-sm-3.col-xs-6.col-md-offset-3
              button.cancel-edit-sources.btn.btn-default.btn-block(type="button") Cancel
            .col-sm-3.col-xs-6
               button.save-edit-sources.btn.btn-primary.btn-block(type="button") Save
          else
            .col-sm-3.col-xs-6.col-md-offset-3
              button.edit-sources.btn.btn-default.btn-block(type="button") Edit Sources

template(name="articles")
  .panel.panel-default
    .panel-heading
      h3 Articles
    .panel-body.comments-container
      if currentUser
        .comment-form
          form#add-article.form-horizontal(novalidate)
            .form-group
              label.col-lg-3.control-label Article URL
              .col-lg-9
                input#article.form-control.new-article(type="url" name="article" required)
            .form-group
              label.col-lg-3.control-label Publication Date
              .col-lg-9
                input#publishDate.form-control.datePicker(type="text" name="publishDate" data-DateTimePicker)
            .form-group
              .col-lg-9.col-lg-offset-3
                .checkbox
                  label
                    input(type="checkbox" value="1" name="scrapeLocations")
                    | Find locations in the article to add to the event
            .form-group
              .col-lg-4.col-lg-offset-8.col-sm-12
                button.btn.btn-primary.btn-block(type="submit") Add article
    if articles.length
      ul.list-group
        each articles
          +article
    else
      p There are no articles currently associated with this event.

template(name="article")
  li.list-group-item
    .row
      .col-sm-10
        a.ref-link(href="{{url}}" target="_blank") {{url}}
          i.fa.fa-external-link
        if publishDate
          p
            small {{publishDate}}
      .col-sm-2.col-xs-6
        if currentUser
          button.btn.btn-danger.btn-sm.btn-block.delete-article Delete

template(name="locationModal")
  .modal.fade(role="dialog")
    .modal-dialog
      .modal-content
        .modal-header
          h4.modal-title Locations mentioned in the article
        .modal-body
          if suggestedLocations.length
            p The linked article contains references to the following locations. Please select which locations you would like to add to the event.
            #suggested-locations-form.form-horizontal
              each suggestedLocations
                .form-group
                  .col-md-12
                    .checkbox
                      label
                        input(type="checkbox" value="{{geonameId}}")
                        | {{locationOptionText(this)}}
                      a(href="{{url}}" target="_blank") (Geonames link)
                        i.fa.fa-external-link
          else
            p No new locations could be found in the linked article.
        .modal-footer
          button.btn.btn-default(type="button" data-dismiss="modal") Close
          if suggestedLocations.length
            button#add-suggestions.btn.btn-primary(type="button") Add Locations

template(name="loadingModal")
  .modal.fade(role="dialog")
    .modal-dialog
      .modal-content
        .modal-body
          p
            i.fa.fa-circle-o-notch.fa-spin
            | Processing article

template(name="articleSelect2")
  select.article-select2.form-control.select2(id="{{selectId}}" multiple)
    each articles
      option(value="{{_id}}") {{url}}

template(name="counts")
  .panel.panel-default
    .panel-heading
      h3 Case/Death Counts
    .panel-body.comments-container
      if currentUser
        .comment-form
          form#add-count.form-horizontal(novalidate)
            .form-group
              label.col-lg-3.control-label Article URL
              .col-lg-9
                select#countArticles.form-control.select2(name="articles" required multiple)
            .form-group
              label.col-lg-3.control-label Date
              .col-lg-9
                input.form-control.datePicker(type="text" name="date" data-DateTimePicker)
            .form-group
              label.col-lg-3.control-label Location
              .col-lg-9
                select#count-location-select2.form-control.select2(name='location')
            .form-group
              label.col-lg-3.control-label Cases
              .col-lg-9
                input.form-control.new-cases(name="cases" required type="number")
            .form-group
              label.col-lg-3.control-label Deaths
              .col-lg-9
                input.form-control.new-deaths(name="deaths" required type="number")
            .form-group
              .col-lg-4.col-lg-offset-8.col-sm-12
                button.btn.btn-primary.btn-block(type="submit") Add Count
    if counts.length
      ul.list-group
        each counts
          +count
    else
      p No case/death counts are associated with this event.

template(name="count")
  li.list-group-item
    .row
      .col-sm-10
        each val in url
          p
            a.ref-link(href="{{val}}" target="_blank") {{val}}
        if date
          p
            small {{date}}
      .col-sm-2.col-xs-6
        if currentUser
          button.btn.btn-danger.btn-sm.btn-block.delete-count Delete
    .row
      .col-sm-2.text-right Location:
      if location
        .col-sm-10 {{location.name}}, {{location.displayName}}, {{location.countryName}}
      else
        | No location specified.
    .row
      if cases
        .col-sm-2.text-right Cases:
        .col-sm-2.text-left {{cases}}
      if deaths
        .col-sm-2.text-right Deaths:
        .col-sm-2.text-left {{deaths}}
